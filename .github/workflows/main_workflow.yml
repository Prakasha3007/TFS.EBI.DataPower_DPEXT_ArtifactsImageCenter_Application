name: Main Workflow.

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  copy-files:
    runs-on: self-hosted
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        
      - name: Test contents parsing
        shell: pwsh
        run: |
          $patterns = @()
          foreach ($line in "a,b,c`nd,e" -split "[`n,]") {
            $trimmed = $line.Trim()
            if ($trimmed) {
              $patterns += $trimmed
            }
          }
          Write-Host "Patterns: $($patterns -join ', ')"
  

      - name: checking the copy files
        uses: ./.github/actions/copyfile-action_v2
        with:
          SourceFolder: src/main
          # contents: '**'
          #SourceFolder: '${{ github.workspace }}'
          #contents: '**\src\main\**'
          #contents: '**\src\main\*.java'
          #contents: 'sample.txt'
          #contents: 'main\flat'
          #contents: '*'
          contents: 'flat\*.txt,java\App.java'
          TargetFolder: "targetFolder"
          CleanTargetFolder: false
          overwrite: false
          FlattenFolders: true
          preserveTimestamp: false
          retryCount: '3'
          delayBetweenRetries: '5000'
          ignoreMakeDirErrors: false
      
      # - name: checking the copy files
      #   uses: ./.github/actions/copyfile-actions_v1
      #   with:
      #     SourceFolder: ./
      #     contents: 'ArtifactsImageCenter_FileManifest.xml'
      #     TargetFolder: "artifacts"
      #     CleanTargetFolder: true
      #     overwrite: false
      #     FlattenFolders: false
      #     preserveTimestamp: false
      #     retryCount: '3'
      #     delayBetweenRetries: '5000'
      #     ignoreMakeDirErrors: false


